[![GoDoc](https://godoc.org/github.com/owulveryck/gohaystack?status.svg)](https://pkg.go.dev/github.com/owulveryck/gohaystack?tab=doc) [![Go Report Card](https://goreportcard.com/badge/github.com/owulveryck/gohaystack)](https://goreportcard.com/report/github.com/owulveryck/gohaystack)
![](https://github.com/owulveryck/gohaystack/workflows/Go/badge.svg)
[![Coverage Status](https://coveralls.io/repos/github/owulveryck/gohaystack/badge.svg?branch=master)](https://coveralls.io/github/owulveryck/gohaystack?branch=master)

# gohaystack

This is a toy library to play with [Project Haystack](https://project-haystack.org/) in Go. It only relies on Go's standard library.

## What is project-haystack?

As stated in the web site

> "`Project Haystack`_ is an open-source initiative to streamline
> working with data from the Internet of Things. We standardize
> semantic data models and web services with the goal of making
> it easier to unlock value from the vast quantity of data being
> generated by the smart devices that permeate our homes, buildings,
> factories, and cities. Applications include automation, control,
> energy, HVAC, lighting, and other environmental systems."
>
> -- Project-Haystack

## What's included

This library is rather incomplete, as I am using it only for testing purpose (discovering haystack, building a sample server, and transform data from a format to another)
This library has a `Grid` structure that can be (de)serialized to and from haystack format in JSON (no zinc yet).
The `Grid` structure supports a couple of methods to add rows, and columns, and also a basic and inefficient search mechanism.

Please, see the API documentation for more information.

It also supports a special type `Tag` to make conversion easier from the Go'internal typed elements and haystack's typed elements.

## Example

### Basic example

Generate a grid and add values:

```go
testGrid := NewGrid()
testGrid.AddColumn("col1", "la colonne 1 (string)")
testGrid.AddColumn("col2", "")
testGrid.AddColumn("col3", "array")
testGrid.AddColumn("col4", "")
err := testGrid.AddRow([]*Tag{
    NewTag(HaystackTypeStr, "bla"),
    NewTag(HaystackTypeStr, "blo"),
    NewTag(HaystackTypeStr, "blu"),
    NewTag(HaystackTypeStr, "bli"),
})
```

### JSON

Generate a grid from a json payload:
```go
gridDB := grid.NewGrid()
dec := json.NewDecoder(os.Stdin)
err := dec.Decode(&gridDB)
if err != nil {
    log.Fatal(err)
}
```

## Complete example

the `example/graph` contains a CLI tool that reads a JSON encoded haystack grid from stdin and generates a dot compatible representation on stdout.

## Caution

This is a toy project given without any warranty. I made it for my own need to discover haystack.
If you want to take over the maintenance, feel free to contact me.
